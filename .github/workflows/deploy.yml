name: Bump Version & Deploy Production

on: [ push ]
#on:
#    push:
#        branches: [ master ]

jobs:
    bump-version:
        name: "Bump Version"
        runs-on: ubuntu-latest

        steps:
            -   uses: actions/checkout@v2

            -   name: Automated Version Bump
                uses: phips28/gh-action-bump-version@v7.1.0

    deploy-production:
        name: "Deploy Production"
        runs-on: ubuntu-latest

        steps:
            -   name: Cache Node Modules
                uses: actions/cache@v2
                env:
                    cache-name: cache-node-modules
                with:
                    path: node_modules
                    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                    restore-keys: |
                        ${{ runner.OS }}-build-${{ env.cache-name }}-
                        ${{ runner.OS }}-build-
                        ${{ runner.OS }}-

            -   name: Install dependencies
                run: npm install

            -   name: Build Production
                run: npm run build --prod

            -   name: Deploy to Firebase Hosting
                uses: FirebaseExtended/action-hosting-deploy@v0
                with:
                    repoToken: "${{ secrets.GITHUB_TOKEN }}"
                    firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}"
#                    expires: # optional, default is 7d
#                    # The project to deploy to. If you leave this blank, make sure you check in a .firebaserc file
#                    projectId: # optional
#                    # The preview channel id to deploy to. If you leave this blank, an channel id will be auto-generated per branch or PR
#                    channelId: # optional
